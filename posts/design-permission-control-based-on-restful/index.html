<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>基于 Go 的 RESTful API 怎么设计权限控制 | 一只麻酱</title><meta name=keywords content="Go"><meta name=description content="其实 RESTful API 实现权限控制的方法很多很多, 比如在每个 Handler 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 Middleware 的方式."><meta name=author content="Mioto Yaku"><link rel=canonical href=https://mioto.me/posts/design-permission-control-based-on-restful/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://mioto.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mioto.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mioto.me/favicon-32x32.png><link rel=apple-touch-icon href=https://mioto.me/apple-touch-icon.png><link rel=mask-icon href=https://mioto.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-102233768-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="基于 Go 的 RESTful API 怎么设计权限控制"><meta property="og:description" content="其实 RESTful API 实现权限控制的方法很多很多, 比如在每个 Handler 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 Middleware 的方式."><meta property="og:type" content="article"><meta property="og:url" content="https://mioto.me/posts/design-permission-control-based-on-restful/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-02-22T13:53:59+00:00"><meta property="article:modified_time" content="2018-02-22T13:53:59+00:00"><meta property="og:site_name" content="一只麻酱"><meta name=twitter:card content="summary"><meta name=twitter:title content="基于 Go 的 RESTful API 怎么设计权限控制"><meta name=twitter:description content="其实 RESTful API 实现权限控制的方法很多很多, 比如在每个 Handler 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 Middleware 的方式."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://mioto.me/posts/"},{"@type":"ListItem","position":3,"name":"基于 Go 的 RESTful API 怎么设计权限控制","item":"https://mioto.me/posts/design-permission-control-based-on-restful/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"基于 Go 的 RESTful API 怎么设计权限控制","name":"基于 Go 的 RESTful API 怎么设计权限控制","description":"其实 RESTful API 实现权限控制的方法很多很多, 比如在每个 Handler 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 Middleware 的方式.\n","keywords":["Go"],"articleBody":"其实 RESTful API 实现权限控制的方法很多很多, 比如在每个 Handler 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 Middleware 的方式.\n资源的分类 /zoos 算一个资源 /employees 也是一个资源\n但是这些资源又有一些不一样的地方.\n栗子:\nGET /zoos 想看动物园的列表, 所有人都可以看, 也不需要登录. PATCH /zoos/ID 更新某个动物园的信息, 只有员工才可以更改, 必须要登录. GET /employees 想看员工列表, 只有是员工, 且还是管理员的人才能看, 必须要登录.\n所以资源是有分类的:\n我归为以下两类.\n角色资源 (Role Resources) 公共资源 (Public Resources) 角色资源: 属于某个角色所有, 只有访问的人属于这个角色才能进行访问. 例: 人事部门 才能对 /employees 资源进行增删改查. 公共资源: 游客,工作人员, 管理人员 都可以进行操作的资源.\n角色 用户 权限 权限组之间的关系 用户: 有哪些角色. 角色: 有哪些权限组 权限. 权限组: 一部分权限的集合(可有可无的一部分, 如果前端每次操作都需要一个一个的去添加权限,为何不把权限打包成一个权限组呢?) 权限: 可以控制访问的资源.\n用户与角色的关系: 一对多 一个用户可以拥有多个权限. 例如:一个用户既是动物园的员工, 也是动物园的管理者. 角色与权限权限组的关系: 一对多 一个角色可以有多个权限组 权限. 例如:管理员 拥有 employees权限组 zoos部分权限. 用户与权限权限组的关系: 一对多 一个用户也可以拥有角色之外的权限权限组. (毕竟有些人就是这么特殊,不考虑不行啊!!)\n表的设计 以下列出的字段只是权限控制中必须的字段, 可以在原先表结构中添加即可.\nResource Nmae Type Description Name string 资源名称 Description string 资源描述 Identity string 资源唯一标识符 (一般可直接使用URL作为唯一标识符后面细讲) Permission Nmae Type Description ResourceID string 资源ID Name string 权限名称 Description string 权限描述 Method string HTTP请求方法 Effect string 作用于自己还是全部 (Allow\u0026Owner) PermissionGroup Nmae Type Description Name string 权限组名称 Description string 权限组描述 PermissionsID []string 权限集合 Role Nmae Type Description Name string 角色名称 Description string 角色描述 PermissionsID []string 权限列表 PermissionGroupsID []string 权限组列表 User Nmae Type Description RolesID []string 角色列表 PermissionsID []string 权限列表 以上所有的表都设计完了, 如果你仔细看上面表的顺序你会发现一点, 他们都是一对多的每一个 Resource 都是根.\n注: Resource 一对多 Permission 一对多 PermissionGroup 一对多 Role 一对多 Role\n权限中间件 以 negroni 为例中间件执行是有顺序的, 根据加载的先后分别执行.\n权限中间件一般位于验证中间件之后, 以下的流程图是以我当前项目为例画出的流程图.\nst=\u003estart: Start ed=\u003eend: End OPmiddlewareBefore=\u003eoperation: Before Middleware OPmiddlewareAuth=\u003eoperation: Auth Middleware 1. QueryTokenAuth 2. HeaderTokenAuth 3. JWTTokenAuth CDauth=\u003econdition: Logined? OPnoLolin=\u003eoperation: Redirect /login OPmiddlewarePermission=\u003eoperation: Permission Middleware CDpermission=\u003econdition: Yes or No OPnoPermission=\u003eoperation: Return HTTP Code 401 OPmiddlewareAfter=\u003eoperation: After Middleware st-\u003eOPmiddlewareBefore-\u003eOPmiddlewareAuth-\u003eCDauth CDauth(no)-\u003eOPnoLolin-\u003eOPmiddlewareBefore CDauth(yes)-\u003eOPmiddlewarePermission-\u003eCDpermission CDpermission(no)-\u003eOPnoPermission CDpermission(yes)-\u003eOPmiddlewareAfter-\u003eed 以下流程图是 Permission Middleware 内部的具体流程\nst=\u003estart: Start ed=\u003eend: End OPgetResource=\u003eoperation: Get Resource conditions: 1. url OPgetPermission=\u003eoperation: Get Permission conditions: 1. resourceID 2. http method OPgetPermissionGroup=\u003eoperation: Get PermissionGroup conditions: 1. permissionID OPgetRole=\u003eoperation: Get Role conditions: 1. permissionID || PermissionGroupID CDResource=\u003econdition: Yes or No OPnoResource=\u003eoperation: Return HTTP Code 404 CDpermission=\u003econdition: Yes or No OPnoPermission=\u003eoperation: Return HTTP Code 500 CDpermissionGroup=\u003econdition: Yes or No OPnoPermissionGroup=\u003eoperation: Return HTTP Code 500 CDrole=\u003econdition: Yes or No OPnoRole=\u003eoperation: Return HTTP Code 500 OPvalidUserPermission=\u003eoperation: Valid User Permission CDvalidUserPermission=\u003econdition: Yes or No OPuserNoPermission=\u003eoperation: Return HTTP Code 401 st-\u003eOPgetResource-\u003eCDResource CDResource(no)-\u003eOPnoResource CDResource(yes)-\u003eOPgetPermission-\u003eCDpermission CDpermission(no)-\u003eOPnoPermission CDpermission(yes)-\u003eOPgetPermissionGroup-\u003eCDpermissionGroup CDpermissionGroup(no)-\u003eOPnoPermissionGroup CDpermissionGroup(yes)-\u003eOPgetRole-\u003eCDrole CDrole(no)-\u003eOPnoRole CDrole(yes)-\u003eOPvalidUserPermission-\u003eCDvalidUserPermission CDvalidUserPermission(no)-\u003eOPuserNoPermission CDvalidUserPermission(yes)-\u003eed 资源唯一标识符 这里讲一下为什么使用以及如何使用 URL 作为唯一标识符.\n这里以 /users API 为例. 分别对应他的操作有\nGET /users - 获取用户列表 GET /users/{id} - 获取具体用户的信息. POST /users - 创建一个用户 PATCH /users/{id} - 更新一个用户的信息 PATCH /users/{id}/password - 更新用户密码 DELETE /users/{id} - 删除一个用户\n假设现在有两个角色分别是 普通用户, 管理员\n资源表其实有两个 /users, /users/\n/users/ 普通用户有权限 /users 普通用户没有权限\n所以 URL 作为资源唯一标识符到 第一层就可以了. 后面的可变的值如 /users/{id} 的 id 部分并不需要考虑.\n以上, 如有疑问欢迎提出, 如果大神看出了缺陷也请告知哈~~\n参考 RESTful API 设计指南 基于RESTful API 怎么设计用户权限控制？ ","wordCount":"385","inLanguage":"zh","datePublished":"2018-02-22T13:53:59Z","dateModified":"2018-02-22T13:53:59Z","author":{"@type":"Person","name":"Mioto Yaku"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mioto.me/posts/design-permission-control-based-on-restful/"},"publisher":{"@type":"Organization","name":"一只麻酱","logo":{"@type":"ImageObject","url":"https://mioto.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mioto.me accesskey=h title="一只麻酱 (Alt + H)">一只麻酱</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mioto.me/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://mioto.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>基于 Go 的 RESTful API 怎么设计权限控制</h1><div class=post-meta><span title='2018-02-22 13:53:59 +0000 UTC'>二月 22, 2018</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;Mioto Yaku</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e8%b5%84%e6%ba%90%e7%9a%84%e5%88%86%e7%b1%bb aria-label=资源的分类>资源的分类</a></li><li><a href=#%e8%a7%92%e8%89%b2-%e7%94%a8%e6%88%b7-%e6%9d%83%e9%99%90-%e6%9d%83%e9%99%90%e7%bb%84%e4%b9%8b%e9%97%b4%e7%9a%84%e5%85%b3%e7%b3%bb aria-label="角色 用户 权限 权限组之间的关系">角色 用户 权限 权限组之间的关系</a></li><li><a href=#%e8%a1%a8%e7%9a%84%e8%ae%be%e8%ae%a1 aria-label=表的设计>表的设计</a><ul><li><a href=#resource aria-label=Resource>Resource</a></li><li><a href=#permission aria-label=Permission>Permission</a></li><li><a href=#permissiongroup aria-label=PermissionGroup>PermissionGroup</a></li><li><a href=#role aria-label=Role>Role</a></li><li><a href=#user aria-label=User>User</a></li></ul></li><li><a href=#%e6%9d%83%e9%99%90%e4%b8%ad%e9%97%b4%e4%bb%b6 aria-label=权限中间件>权限中间件</a></li><li><a href=#%e8%b5%84%e6%ba%90%e5%94%af%e4%b8%80%e6%a0%87%e8%af%86%e7%ac%a6 aria-label=资源唯一标识符>资源唯一标识符</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><p>其实 <code>RESTful API</code> 实现权限控制的方法很多很多, 比如在每个 <code>Handler</code> 中进行判断, 但是这种写法会导致工作量无限增加, 万一增加了其他的角色还要不停的更改源码, 所以要以尽量优雅的方式来实现这个部分. 比如 <code>Middleware</code> 的方式.</p><h2 id=资源的分类>资源的分类<a hidden class=anchor aria-hidden=true href=#资源的分类>#</a></h2><p><code>/zoos</code> 算一个资源
<code>/employees</code> 也是一个资源</p><p>但是这些资源又有一些不一样的地方.</p><p>栗子:</p><p><code>GET /zoos</code> 想看动物园的列表, 所有人都可以看, 也不需要登录.
<code>PATCH /zoos/ID</code> 更新某个动物园的信息, 只有员工才可以更改, 必须要登录.
<code>GET /employees</code> 想看员工列表, 只有是员工, 且还是管理员的人才能看, 必须要登录.</p><p>所以资源是有分类的:</p><p>我归为以下两类.</p><ol><li>角色资源 (Role Resources)</li><li>公共资源 (Public Resources)</li></ol><p><strong>角色资源</strong>: 属于某个角色所有, 只有访问的人属于这个角色才能进行访问. 例: 人事部门 才能对 <code>/employees</code> 资源进行增删改查.
<strong>公共资源</strong>: 游客,工作人员, 管理人员 都可以进行操作的资源.</p><h2 id=角色-用户-权限-权限组之间的关系>角色 用户 权限 权限组之间的关系<a hidden class=anchor aria-hidden=true href=#角色-用户-权限-权限组之间的关系>#</a></h2><p>用户: 有哪些角色.
角色: 有哪些权限组 权限.
权限组: 一部分权限的集合(可有可无的一部分, 如果前端每次操作都需要一个一个的去添加权限,为何不把权限打包成一个权限组呢?)
权限: 可以控制访问的资源.</p><p>用户与角色的关系: <code>一对多</code> 一个用户可以拥有多个权限. 例如:一个用户既是动物园的员工, 也是动物园的管理者.
角色与权限权限组的关系: <code>一对多</code> 一个角色可以有多个权限组 权限. 例如:管理员 拥有 employees权限组 zoos部分权限.
用户与权限权限组的关系: <code>一对多</code> 一个用户也可以拥有角色之外的权限权限组. (毕竟有些人就是这么特殊,不考虑不行啊!!)</p><h2 id=表的设计>表的设计<a hidden class=anchor aria-hidden=true href=#表的设计>#</a></h2><p>以下列出的字段只是权限控制中必须的字段, 可以在原先表结构中添加即可.</p><h3 id=resource>Resource<a hidden class=anchor aria-hidden=true href=#resource>#</a></h3><table><thead><tr><th style=text-align:center>Nmae</th><th style=text-align:center>Type</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:center>Name</td><td style=text-align:center>string</td><td style=text-align:center>资源名称</td></tr><tr><td style=text-align:center>Description</td><td style=text-align:center>string</td><td style=text-align:center>资源描述</td></tr><tr><td style=text-align:center>Identity</td><td style=text-align:center>string</td><td style=text-align:center>资源唯一标识符 (一般可直接使用URL作为唯一标识符后面细讲)</td></tr></tbody></table><h3 id=permission>Permission<a hidden class=anchor aria-hidden=true href=#permission>#</a></h3><table><thead><tr><th style=text-align:center>Nmae</th><th style=text-align:center>Type</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:center>ResourceID</td><td style=text-align:center>string</td><td style=text-align:center>资源ID</td></tr><tr><td style=text-align:center>Name</td><td style=text-align:center>string</td><td style=text-align:center>权限名称</td></tr><tr><td style=text-align:center>Description</td><td style=text-align:center>string</td><td style=text-align:center>权限描述</td></tr><tr><td style=text-align:center>Method</td><td style=text-align:center>string</td><td style=text-align:center>HTTP请求方法</td></tr><tr><td style=text-align:center>Effect</td><td style=text-align:center>string</td><td style=text-align:center>作用于自己还是全部 (Allow&Owner)</td></tr></tbody></table><h3 id=permissiongroup>PermissionGroup<a hidden class=anchor aria-hidden=true href=#permissiongroup>#</a></h3><table><thead><tr><th style=text-align:center>Nmae</th><th style=text-align:center>Type</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:center>Name</td><td style=text-align:center>string</td><td style=text-align:center>权限组名称</td></tr><tr><td style=text-align:center>Description</td><td style=text-align:center>string</td><td style=text-align:center>权限组描述</td></tr><tr><td style=text-align:center>PermissionsID</td><td style=text-align:center>[]string</td><td style=text-align:center>权限集合</td></tr></tbody></table><h3 id=role>Role<a hidden class=anchor aria-hidden=true href=#role>#</a></h3><table><thead><tr><th style=text-align:center>Nmae</th><th style=text-align:center>Type</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:center>Name</td><td style=text-align:center>string</td><td style=text-align:center>角色名称</td></tr><tr><td style=text-align:center>Description</td><td style=text-align:center>string</td><td style=text-align:center>角色描述</td></tr><tr><td style=text-align:center>PermissionsID</td><td style=text-align:center>[]string</td><td style=text-align:center>权限列表</td></tr><tr><td style=text-align:center>PermissionGroupsID</td><td style=text-align:center>[]string</td><td style=text-align:center>权限组列表</td></tr></tbody></table><h3 id=user>User<a hidden class=anchor aria-hidden=true href=#user>#</a></h3><table><thead><tr><th style=text-align:center>Nmae</th><th style=text-align:center>Type</th><th style=text-align:center>Description</th></tr></thead><tbody><tr><td style=text-align:center>RolesID</td><td style=text-align:center>[]string</td><td style=text-align:center>角色列表</td></tr><tr><td style=text-align:center>PermissionsID</td><td style=text-align:center>[]string</td><td style=text-align:center>权限列表</td></tr></tbody></table><p>以上所有的表都设计完了, 如果你仔细看上面表的顺序你会发现一点, 他们都是一对多的每一个 <code>Resource</code> 都是根.</p><p>注: <strong>Resource 一对多 Permission 一对多 PermissionGroup 一对多 Role 一对多 Role</strong></p><h2 id=权限中间件>权限中间件<a hidden class=anchor aria-hidden=true href=#权限中间件>#</a></h2><p>以 <a href=https://github.com/urfave/negroni>negroni</a> 为例中间件执行是有顺序的, 根据加载的先后分别执行.</p><p>权限中间件一般位于验证中间件之后, 以下的流程图是以我当前项目为例画出的流程图.</p><pre tabindex=0><code class=language-flow data-lang=flow>st=&gt;start: Start
ed=&gt;end: End
OPmiddlewareBefore=&gt;operation: Before Middleware
OPmiddlewareAuth=&gt;operation: Auth Middleware
1. QueryTokenAuth
2. HeaderTokenAuth
3. JWTTokenAuth
CDauth=&gt;condition: Logined?
OPnoLolin=&gt;operation: Redirect /login
OPmiddlewarePermission=&gt;operation: Permission Middleware
CDpermission=&gt;condition: Yes or No
OPnoPermission=&gt;operation: Return HTTP Code 401
OPmiddlewareAfter=&gt;operation: After Middleware

st-&gt;OPmiddlewareBefore-&gt;OPmiddlewareAuth-&gt;CDauth
CDauth(no)-&gt;OPnoLolin-&gt;OPmiddlewareBefore
CDauth(yes)-&gt;OPmiddlewarePermission-&gt;CDpermission
CDpermission(no)-&gt;OPnoPermission
CDpermission(yes)-&gt;OPmiddlewareAfter-&gt;ed
</code></pre><p>以下流程图是 <code>Permission Middleware</code> 内部的具体流程</p><pre tabindex=0><code class=language-flow data-lang=flow>st=&gt;start: Start
ed=&gt;end: End
OPgetResource=&gt;operation: Get Resource
conditions:
1. url
OPgetPermission=&gt;operation: Get Permission
conditions:
1. resourceID
2. http method
OPgetPermissionGroup=&gt;operation: Get PermissionGroup
conditions:
1. permissionID
OPgetRole=&gt;operation: Get Role
conditions:
1. permissionID || PermissionGroupID
CDResource=&gt;condition: Yes or No
OPnoResource=&gt;operation: Return HTTP Code 404
CDpermission=&gt;condition: Yes or No
OPnoPermission=&gt;operation: Return HTTP Code 500
CDpermissionGroup=&gt;condition: Yes or No
OPnoPermissionGroup=&gt;operation: Return HTTP Code 500
CDrole=&gt;condition: Yes or No
OPnoRole=&gt;operation: Return HTTP Code 500
OPvalidUserPermission=&gt;operation: Valid User Permission
CDvalidUserPermission=&gt;condition: Yes or No
OPuserNoPermission=&gt;operation: Return HTTP Code 401

st-&gt;OPgetResource-&gt;CDResource
CDResource(no)-&gt;OPnoResource
CDResource(yes)-&gt;OPgetPermission-&gt;CDpermission
CDpermission(no)-&gt;OPnoPermission
CDpermission(yes)-&gt;OPgetPermissionGroup-&gt;CDpermissionGroup
CDpermissionGroup(no)-&gt;OPnoPermissionGroup
CDpermissionGroup(yes)-&gt;OPgetRole-&gt;CDrole
CDrole(no)-&gt;OPnoRole
CDrole(yes)-&gt;OPvalidUserPermission-&gt;CDvalidUserPermission
CDvalidUserPermission(no)-&gt;OPuserNoPermission
CDvalidUserPermission(yes)-&gt;ed
</code></pre><h2 id=资源唯一标识符>资源唯一标识符<a hidden class=anchor aria-hidden=true href=#资源唯一标识符>#</a></h2><p>这里讲一下为什么使用以及如何使用 <code>URL</code> 作为唯一标识符.</p><p>这里以 <code>/users</code> API 为例. 分别对应他的操作有</p><p>GET /users - 获取用户列表
GET /users/{id} - 获取具体用户的信息.
POST /users - 创建一个用户
PATCH /users/{id} - 更新一个用户的信息
PATCH /users/{id}/password - 更新用户密码
DELETE /users/{id} - 删除一个用户</p><p>假设现在有两个角色分别是 <code>普通用户</code>, <code>管理员</code></p><p>资源表其实有两个 <code>/users</code>, <code>/users/</code></p><p><code>/users/</code> 普通用户有权限 <code>/users</code> 普通用户没有权限</p><p>所以 <code>URL</code> 作为资源唯一标识符到 第一层就可以了. 后面的可变的值如 <code>/users/{id}</code> 的 <code>id</code> 部分并不需要考虑.</p><p>以上, 如有疑问欢迎提出, 如果大神看出了缺陷也请告知哈~~</p><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=http://www.ruanyifeng.com/blog/2014/05/restful_api.html>RESTful API 设计指南</a></li><li><a href=https://www.jianshu.com/p/db65cf48c111>基于RESTful API 怎么设计用户权限控制？</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://mioto.me/tags/go/>Go</a></li></ul></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//yakumioto.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2023 <a href=https://mioto.me>一只麻酱</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>