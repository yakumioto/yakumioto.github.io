<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>学习 | 一只麻酱</title>
<meta name=keywords content><meta name=description content="我们都期待自己的存在是特殊的，到头来却平凡不已。"><meta name=author content="Mioto Yaku"><link rel=canonical href=https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://mioto.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mioto.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mioto.me/favicon-32x32.png><link rel=apple-touch-icon href=https://mioto.me/apple-touch-icon.png><link rel=mask-icon href=https://mioto.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/index.xml><link rel=alternate hreflang=zh href=https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="学习"><meta property="og:description" content="我们都期待自己的存在是特殊的，到头来却平凡不已。"><meta property="og:type" content="website"><meta property="og:url" content="https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/"><meta property="og:site_name" content="一只麻酱"><meta name=twitter:card content="summary"><meta name=twitter:title content="学习"><meta name=twitter:description content="我们都期待自己的存在是特殊的，到头来却平凡不已。"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mioto.me/ accesskey=h title="一只麻酱 (Alt + H)">一只麻酱</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mioto.me/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://mioto.me/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>学习</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go 100 行实现 HTTP(S) 正向代理</h2></header><div class=entry-content><p>目标是现实一个 HTTP HTTPS 的代理服务器, 目前代理的实现方法有两种
普通代理: 这种代理扮演的是中间人角色, 对于客户端来说, 它就服务器, 对于服务端来说, 它是客户端, 它负责在中间来回传递 HTTP 报文
隧道代理: 它是通过 HTTP 正文部分(body) 完成代理, 以 HTTP 的方式实现基于 TCP 的应用层协议代理, 这种代理使用 HTTP 的 CONNECT 方法建立连接
这是一次 HTTP 的请求, 用 \r\n 进行换行, 碰到连续两个 \r\n 后内容为请求数据, 分为以下几个部分
请求行 (request line) 请求头 (header) 空行 请求数据 (body) curl -Lv http://baidu.com > GET / HTTP/1.1 > Host: baidu.com > User-Agent: curl/7.68.0 > Accept: */* > * Mark bundle as not supporting multiuse &lt; HTTP/1....</p></div><footer class=entry-footer><span title='2019-08-21 00:00:00 +0000 UTC'>八月 21, 2019</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to Go 100 行实现 HTTP(S) 正向代理" href=https://mioto.me/posts/http-s-proxy-in-golang-in-less-than-100-lines-of-code/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>破解某Wi-Fi探针魔盒的过程</h2></header><div class=entry-content><p>有个老同学，在老家做销售工作， 某一天忽然联系我说我有个路由器可以扫描周边的 MAC Address 直接得到手机号，我一听这个牛逼啊，然后就让把路由器发来玩玩了
这东西有两个部分一个是手机应用程序，一个是路由器。
App抓包 最初设想路由器既然要用 Wi-Fi 手机当作热点数据必定经过手机，说干就干，下载了个 HttpCanary 然后对 App 抓包
过滤掉没用的接口后得到了两个核心接口（说真的 App 设计的真心让人恶心，所有权限都要可能为了读取手机上的联系人把）
用来获取已经匹配到的手机号的接口 GET http://x.hnyzlp.com/api/merchart/Operative/phone 用来设置心跳的接口，同时设置经纬度 GET http://x.hnyzlp.com/api/merchart/Operative/set_address 到此为止并没有 MAC 实际发出的地址， 所以由此可证明路由器直接将数据发送到了远端服务器，这条路被斩断了
路由器抓包 起初想的是通过 ARP 诈骗让自己家的路由器把数据发送到我指定的设备来实现抓包，但是！Mac 下各种问题，搞了一个多小时没搞定，卒！
后来想起来我的路由器是可编程的啊！，于是乎找了个 AC68U 可用的 tcpdump 路由器上抓指定网卡的的指定IP，然后！又得到了两个核心接口
用来设置路由器心跳， 一分钟请求一次 获取路由器上的运行时间， ARM 状况 等。 POST http://api.swsf3.cn/api_v1/remotecontrol 用来发送 mac 地址到服务端， 频率是 30 秒一次 POST http://api.swsf3.cn/api_v2/report 由此可见所有东西都全了！， 上传数据的接口， 以及查看数据的接口</p></div><footer class=entry-footer><span title='2019-06-07 00:00:00 +0000 UTC'>六月 7, 2019</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to 破解某Wi-Fi探针魔盒的过程" href=https://mioto.me/posts/cracking-mohe-process/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>部署 Kubernetes 遇到的问题</h2></header><div class=entry-content><p>Unable to update cni config: No networks found in /etc/cni/net.d 由于设置了代理导致的错误, kubelet 无法通过代理链接到 kube-apiserve
解决办法:
unset http_proxy https_proxy # or export no_proxy=&lt;your_kube_apiserver_ip> port 10251 and 10252 are in use 多次 init 导致的错误
解决办法:
kubeadm reset ROLES none 关于 ROLES &lt;none> 的问题, 据说在 kubeadm join 的时候可以指定, 不过我每次都没看..
解决办法:
# 添加标签 kubectl label node {node name} node-role.kubernetes.io/{key}={value} # example kubectl label node host2 node-role.kubernetes.io/node2=node2 # 删除标签 kubectl label node {node name} node-role.kubernetes.io/{key}- # example kubectl label node host2 node-role....</p></div><footer class=entry-footer><span title='2019-05-29 00:00:00 +0000 UTC'>五月 29, 2019</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to 部署 Kubernetes 遇到的问题" href=https://mioto.me/posts/problem-swith-deploying-kubernetes/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go HTTP POST 附件</h2></header><div class=entry-content><p>前段时间为了使用 adb 进行钉钉打卡, 写了个 Go 的程序, 想着万一没打上怎么办, 不如截个图发给自己(现在以 root, 辣鸡钉钉), 文章只为了记录一下实现.
// curl -X POST https://example.com/sendPhoto -F photo=@./screen.png // 以下代码是根据以上 curl 命令的实现 buf := &amp;bytes.Buffer{} mu := multipart.NewWriter(buf) part, err := mu.CreatePart(textproto.MIMEHeader{ "Content-Disposition": []string{`form-data; name="photo"; filename="screen.png"`}, "Content-Type":[]string{"application/octet-stream"}, }) checkError(err) fp, _ := os.Open("/home/mioto/screen.png") io.Copy(part, fp) mu.Close() req, err := http.NewRequest(http.MethodPost, "https://example.com/sendPhoto", bf) checkError(err) req.Header.Set("Content-Type", mu.FormDataContentType()) res, err := http.DefaultClient.Do(req) checkError(err)</p></div><footer class=entry-footer><span title='2019-05-16 00:00:00 +0000 UTC'>五月 16, 2019</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to Go HTTP POST 附件" href=https://mioto.me/posts/go-http-post-attachment/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go 解析 ECPrivate Key 遇到的问题</h2></header><div class=entry-content><p>最近在做 fabric 证书私钥管理系统, 遇到的一个问题, 在使用 x509.ParseECPrivateKey() 方法的时候会直接报错, 而 fabric 确实用的是 椭圆曲线算法
错误输出: x509: failed to parse EC private key: asn1: structure error: tags don't match (4 vs {class:0 tag:16 length:19 isCompound:true}) {optional:false explicit:false application:false private:false defaultValue:&lt;nil> tag:&lt;nil> stringType:0 timeType:0 set:false omitEmpty:false} @5
原因是 fabric 将私钥转成 pem 格式的时候使用的方法是 x509.MarshalPKCS8PrivateKey()
解决办法 block, _ := pem.Decode(pemBytes) key, err := x509.ParsePKCS8PrivateKey(block.Bytes) checkErr(err) switch priv := key.(type) { case *ecdsa.PrivateKey: // do something }</p></div><footer class=entry-footer><span title='2019-05-07 08:45:00 +0000 UTC'>五月 7, 2019</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to Go 解析 ECPrivate Key 遇到的问题" href=https://mioto.me/posts/go-parse-ec-private-key/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>i3wm 更换默认打开的文件管理器</h2></header><div class=entry-content><p>可以通过 xdg-mime 来查询当前默认的文件管理器 xdg-mime query default inode/directory
mioto:~/ $ xdg-mime query default inode/directory visual-studio-code.desktop 方法一 还是可以通过 xdg-mime 来设置默认文件管理器 xdg-mime default {file manager}.desktop inode/directory
mioto:~/ $ xdg-mime default ranger.desktop inode/directory mioto:~/ $ xdg-mime query default inode/directory ranger.desktop 方法二 我记录有2个 mimeapps.list 文件修改点
~/.local/share/applications/mimeapps.list, ~/.config/mimeapps.list 选一个修改(没有添加) inode/directory=ranger.desktop
但是我的系统 Manjaro-I3 使用的是 ~/.config/mimeapps.list, 所以有针对性的修改就行</p></div><footer class=entry-footer><span title='2019-04-28 11:00:00 +0000 UTC'>四月 28, 2019</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to i3wm 更换默认打开的文件管理器" href=https://mioto.me/posts/i3-change-default-file-manager/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Go反序列化JSON格式化时间</h2></header><div class=entry-content><p>默认得到的序列化后的结果是 {"t":"2018-11-25T20:04:51.362485618+08:00"}, 但如果我想得到 {"t":"2018-11-25 20:04:51"} 该怎么办呢?
方法一 实现 MarshalJSON 接口, 同时可能也需要反序列化, 所以还需要实现 UnmarshalJSON, 以下代码为实现
package main import ( "encoding/json" "fmt" "time" ) type Time struct { T time.Time `json:"t,omitempty"` } func (t *Time) MarshalJSON() ([]byte, error) { type alias Time return json.Marshal(struct { *alias T string `json:"t,omitempty"` }{ alias: (*alias)(t), T: t.T.Format("2006-01-02 15:04:05"), }) } func (t *Time) UnmarshalJSON(data []byte) error { type alias Time tmp := &amp;struct { *alias T string `json:"t,omitempty"` }{ alias: (*alias)(t), } err := json....</p></div><footer class=entry-footer><span title='2018-11-25 19:46:00 +0000 UTC'>十一月 25, 2018</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to Go反序列化JSON格式化时间" href=https://mioto.me/posts/go-serialize-json-fromat-time/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>RaspberryZero网络与OTG配置.md</h2></header><div class=entry-content><p>买 Raspberry Zero 的原因呢, 是因为钉钉打卡, 每次可能晚了那么几分钟, 但我就是起不来啊…
这篇文章主要讲三个点 无屏幕 SSH, Static IP, 开启OTG模式
SSH 当然在 ssh 的时候要保证 Raspberry Zero 是有网的状态, 编辑第二个分区 wpa-supplicant 的配置文件 /etc/wpa_supplicant/wpa_supplicant.conf
基本网络配置 network={ ssid="testing" psk="testingPassword" } ssid 无线网络名称, psk 无线网络密码
隐藏网络配置 network={ ssid="testing" scan_ssid=1 psk="testingPassword" } 多个网络配置 network={ ssid="HomeOneSSID" psk="passwordOne" priority=1 id_str="homeOne" } network={ ssid="HomeTwoSSID" psk="passwordTwo" priority=2 id_str="homeTwo" } priority 网络优先级
连接 SSH 如果网络配置没问题的话,现在应该已经连接上了无线网络了, 接下来就是在无屏幕状态下如何 ssh 到 Raspberry Zero
挂载第一分区在 / 目录创建 SSH 文件就可以了, 然后插电启动 Raspberry Zero 等待自动连接到网络后进行后续操作...</p></div><footer class=entry-footer><span title='2018-11-01 19:08:00 +0000 UTC'>十一月 1, 2018</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to RaspberryZero网络与OTG配置.md" href=https://mioto.me/posts/raspberry-zero-network-and-otg-configuration/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>为终端设置代理</h2></header><div class=entry-content><p>现在一般都是使用 SS FQ 了吧, 所以都是 SOCKS5 代理, 但是在终端有些程序是不支持 SOCKS5 的, 比如 go get
方法一 如果你的 SS 目前 Cow 支持的加密算法有: aes-128-cfb, aes-192-cfb, aes-256-cfb, bf-cfb, cast5-cfb, des-cfb, rc4-md5, chacha20, salsa20, rc4, table
安装教程参见 https://github.com/cyfdecyf/cow#快速开始
方法二 如果你用的 SS 加密算法不在以上支持的情况
可以先使用 ss-local 在本地开启 SOCKS5 然后在通过 Cow 将 SOCKS5 转 HTTP</p></div><footer class=entry-footer><span title='2018-10-05 16:21:00 +0000 UTC'>十月 5, 2018</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to 为终端设置代理" href=https://mioto.me/posts/setting-up-agents-for-terminals/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>私有-docker-registry-搭建</h2></header><div class=entry-content><p>简介 这个东西可能并没有你想象中的那么完美, 适合个人使用, 上传后无法删除镜像, 但是有第三方工具帮你删除后面会讲. 如果这几点你都不介意的话, 可以继续往下看了!!!
docker 的基础操作我都不会讲, 如果不太了解的话建议去官网学习
必备的程序 docker-ce, docker-compose.
本机搭建 registry 的默认端口为 5000
如果想将 hub.docker.com 上的 alpine 做个镜像.
docker pull alpine:latest docker tag alpine:latest localhost:5000/alpine:latest docker push localhost:5000/alpine:latest --- version: "2" services: registry: image: registry:latest restart: always volumes: - registry:/var/lib/registry volumes: registry: 配置前端 registry-frontend 是 registry 的前端, 如果想详细设置可以去 konradkleine/docker-registry-frontend 这里看.
效果图如下:
--- version: "2" services: registry: image: registry:latest restart: always volumes: - registry:/var/lib/registry registry-frontend: image: konradkleine/docker-registry-frontend:v2 environment: ENV_DOCKER_REGISTRY_HOST: registry ENV_DOCKER_REGISTRY_PORT: "5000" ENV_MODE_BROWSE_ONLY: "true" depends_on: - registry volumes: registry: 配置域名与认证 我使用的是 caddy 作为我的反向代理服务器, 当然你也可以使用 nginx 等....</p></div><footer class=entry-footer><span title='2018-08-19 18:14:15 +0000 UTC'>八月 19, 2018</span>&nbsp;·&nbsp;1 分钟&nbsp;·&nbsp;Mioto Yaku</footer><a class=entry-link aria-label="post link to 私有-docker-registry-搭建" href=https://mioto.me/posts/private-docker-registry-deploy/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/>«&nbsp;上一页&nbsp;
</a><a class=next href=https://mioto.me/categories/%E5%AD%A6%E4%B9%A0/page/3/>下一页&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://mioto.me/>一只麻酱</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>